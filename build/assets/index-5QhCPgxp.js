(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))d(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function c(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(a){if(a.ep)return;a.ep=!0;const n=c(a);fetch(a.href,n)}})();const L="https://continuous-beneficial-tithonia.glitch.me/";let k=[],i=[];const _=localStorage.getItem("favourite")?JSON.parse(localStorage.getItem("favourite")):[],r=new Audio,o=document.getElementsByClassName("track"),g=document.querySelector(".player"),h=document.querySelector(".player__action_pause"),M=document.querySelector(".player__action_stop"),T=document.querySelector(".player__action_prev"),S=document.querySelector(".player__action_next"),f=document.querySelector(".player__action_mute"),l=document.querySelector(".player__action_favourite"),v=document.querySelector(".player__range"),O=document.querySelector(".player__time-passed"),P=document.querySelector(".player__time-total"),p=document.querySelector(".player__volume-range"),A=document.querySelector(".track-info__title"),I=document.querySelector(".track-info__artist"),w=document.querySelector(".header__logo"),q=document.querySelector(".header__search"),N=document.querySelector(".header__favourite"),m=document.querySelector(".catalog__list");function H(e,t){let c=null;return function(...a){c||(c=setTimeout(()=>{e(...a),clearTimeout(c),c=null},t))}}const x=()=>{const e=document.querySelector(".track_active");r.paused?(r.play(),h.classList.remove("player__action_play"),e.classList.remove("track_pause")):(r.pause(),h.classList.add("player__action_play"),e.classList.add("track_pause"))},E=e=>{e.preventDefault();const t=e.currentTarget;if(t.classList.contains("track_active")){x();return}const c=t.dataset.track;_.indexOf(c)!==-1?l.classList.add("player__action_favourite_active"):l.classList.remove("player__action_favourite_active");let a=0;const n=i.find((u,B)=>(a=B,c===u.id));r.src=`${L}${n.mp3}`,I.textContent=n.artist,A.textContent=n.track,r.play(),h.classList.remove("player__action_play"),g.classList.add("player_active"),g.dataset.track=c;const s=a===0?i.length-1:a-1,b=a+1===i.length?0:a+1;T.dataset.track=i[s].id,S.dataset.track=i[b].id,l.dataset.track=c;for(let u=0;u<o.length;u++)c===o[u].dataset.track?o[u].classList.add("track_active"):o[u].classList.remove("track_active")},F=()=>{for(let e=0;e<o.length;e++)o[e].addEventListener("click",E)},R=e=>{const t=document.createElement("li");return t.classList.add("catalog__item"),t.innerHTML=`
        <a class="catalog__track track" href="#" data-track="${e.id}">
          <div class="track__img-inner">
            <img class="track__poster" src="${L}${e.poster}" alt="${e.artist} ${e.track}" />
          </div>
          <div class="track__info track-info">
            <p class="track-info__title">${e.track}</p>
            <p class="track-info__artist">${e.artist}</p>
          </div>
        </a>
    `,g.dataset.track===e.id&&(t.firstElementChild.classList.add("track_active"),r.paused&&t.firstElementChild.classList.add("track_pause")),t},y=e=>{if(i=[...e],i.length===0){m.textContent="Ничего не найдено";return}m.textContent="";const t=e.map(R);m.append(...t),F();const c=D();$(c)},$=(e,t=1)=>{if(m.children.length!==0){if(m.clientHeight>o[0].clientHeight*3)return o[o.length-t].style.display="none",$(e,t+1);t!==1&&m.append(e)}},j=()=>{const e=r.duration,t=r.currentTime,c=t/e*v.max;v.value=c||0;const d=Math.floor(t/60)||"0",a=Math.floor(t%60)||"0",n=Math.floor(e/60)||"0",s=Math.floor(e%60)||"0";O.textContent=`${d}:${a<10?"0"+a:a}`,P.textContent=`${n}:${s<10?"0"+s:s}`},D=()=>{const e=document.createElement("div");return e.classList.add("catalog__show-more-inner"),e.innerHTML=`
    <button class="catalog__show-more">Увидеть всё</button>
   `,e.addEventListener("click",function(){[...o].forEach(t=>{t.style.display="",e.remove()})}),e},C=()=>{T.addEventListener("click",E),S.addEventListener("click",E),h.addEventListener("click",x),r.addEventListener("ended",function(){S.dispatchEvent(new Event("click",{bubbles:!0}))});const e=H(j,700);r.addEventListener("timeupdate",e),v.addEventListener("change",function(){const t=v.value;r.currentTime=t/v.max*r.duration}),N.addEventListener("click",function(){const t=k.filter(c=>_.includes(c.id));y(t)}),M.addEventListener("click",function(t){r.src="",g.classList.remove("player_active"),document.querySelector(".track_active")&&document.querySelector(".track_active").classList.remove("track_active")}),w.addEventListener("click",function(){y(k)}),l.addEventListener("click",function(){const t=_.indexOf(l.dataset.track);t===-1?(_.push(l.dataset.track),l.classList.add("player__action_favourite_active")):(_.splice(t,1),l.classList.remove("player__action_favourite_active")),localStorage.setItem("favourite",JSON.stringify(_))}),p.addEventListener("input",function(){f.classList.remove("player__action_unmute");const t=p.value;r.volume=t/100}),f.addEventListener("click",function(){r.volume?(localStorage.setItem("volume",r.volume),r.volume=0,f.classList.add("player__action_unmute"),p.value=0):(r.volume=localStorage.getItem("volume"),f.classList.remove("player__action_unmute"),p.value=r.volume*100)}),q.addEventListener("submit",async function(t){t.preventDefault(),i=await fetch(`${L}api/music?search=${q.search.value}`).then(c=>c.json()),y(i),C()})},J=async()=>{r.volume=localStorage.getItem("volume")||1,p.value=r.volume*100,k=await fetch(`${L}api/music`).then(e=>e.json()),y(k),C()};J();
